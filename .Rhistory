# Instala/Carrega pacotes silenciosamente
suppressPackageStartupMessages({
sapply(required_packages, require, character.only = TRUE)
})
required_packages <- c("phyloseq", "vegan", "ggplot2", "ggpubr", "cowplot", "dplyr",
"DESeq2", "scater", "rprojroot", "pairwiseAdonis", "pheatmap",
"viridis", "ape", "microbiome", "wesanderson", "RColorBrewer",
"ANCOMBC")
# Instala/Carrega pacotes silenciosamente
suppressPackageStartupMessages({
sapply(required_packages, require, character.only = TRUE)
})
########################################### Configuration ###################################
library(jsonlite)
library(rprojroot)
# Localiza a raiz do projeto
script_dir <- tryCatch(find_root(has_file("Analise.R")), error = function(e) getwd())
print(paste("Working directory:", script_dir))
# Load Metadata
metadata_files <- list.files(path = metadata_dir, pattern = "\\.tsv$|\\.csv$", full.names = TRUE)
metadata_dir <- file.path(script_dir, "Metadata File")
# Load Metadata
metadata_files <- list.files(path = metadata_dir, pattern = "\\.tsv$|\\.csv$", full.names = TRUE)
if (length(metadata_files) > 0) {
sep <- ifelse(grepl("\\.tsv$", metadata_files[1]), "\t", ",")
metadataTab <- read.csv(metadata_files[1], header = TRUE, row.names = 1, sep = sep, check.names = FALSE)
message("Metadata loaded.")
} else {
stop("No metadata file found.")
}
metadata_dir <- file.path(script_dir, "Metadata File/")
# Load Metadata
metadata_files <- list.files(path = metadata_dir, pattern = "\\.tsv$|\\.csv$", full.names = TRUE)
metadata_dir <- file.path(script_dir, "Metadata File/")
# Load Metadata
metadata_files <- list.files(path = metadata_dir, pattern = "\\.tsv$|\\.csv$", full.names = TRUE)
metadata_dir <- file.path(script_dir, "Metadata File")
metadata_files <- list.files(path = metadata_dir, pattern = "\\.(tsv|csv|txt)$", full.names = TRUE, ignore.case = TRUE)
if (length(metadata_files) > 0) {
target_file <- metadata_files[1]
if (length(metadata_files) > 1) {
warning(paste("More than one metadata file found. Using the first one:", target_file))
}
get_separator <- function(file_path) {
first_line <- readLines(file_path, n = 1)
n_tab <- lengths(regmatches(first_line, gregexpr("\t", first_line)))
n_comma <- lengths(regmatches(first_line, gregexpr(",", first_line)))
n_semi <- lengths(regmatches(first_line, gregexpr(";", first_line)))
if (n_tab > n_comma && n_tab > n_semi) return("\t")
if (n_semi > n_comma && n_semi > n_tab) return(";")
return(",") # Default para CSV se houver dÃºvida
}
detected_sep <- get_separator(target_file)
message(paste("Metadata file detected:", basename(target_file), "| Separator detected:", ifelse(detected_sep == "\t", "TAB", detected_sep)))
metadataTab <- read.table(target_file,
header = TRUE,
row.names = 1,
sep = detected_sep,
check.names = FALSE,
fill = TRUE,
quote = "")
message("Metadata loaded successfully.")
} else {
stop("No metadata file (csv, tsv, txt) found in the specified directory.")
}
required_packages <- c("phyloseq", "vegan", "ggplot2", "ggpubr", "cowplot", "dplyr",
"DESeq2", "scater", "rprojroot", "pairwiseAdonis", "pheatmap",
"viridis", "ape", "microbiome", "wesanderson", "RColorBrewer",
"ANCOMBC")
# Instala/Carrega pacotes silenciosamente
suppressPackageStartupMessages({
sapply(required_packages, require, character.only = TRUE)
})
################################### Loading Packages ########################################
install.packages("ggrepel")
